// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package pages

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "accounting-agent/web/templates/layouts"

// JournalEntry renders the manual journal entry form.
func JournalEntry(d layouts.AppLayoutData, companyCode string) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div class=\"max-w-3xl space-y-5\"><!-- Page header --><div><h1 class=\"text-2xl font-bold text-slate-900\">Manual Journal Entry</h1><p class=\"text-sm text-slate-500 mt-0.5\">Post a double-entry journal entry directly to the ledger.</p></div><!-- Form --><div class=\"bg-white rounded-xl border border-gray-200 p-6 space-y-5\" x-data=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var3 string
			templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs("journalEntryForm(" + jeCompanyCode(companyCode) + ")")
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `web/templates/pages/journal_entry.templ`, Line: 17, Col: 67}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "\"><!-- Result feedback --><div x-show=\"result.message\" x-cloak><div x-bind:class=\"result.ok ? 'bg-green-50 border-green-200 text-green-700' : 'bg-red-50 border-red-200 text-red-700'\" class=\"border rounded-lg p-3 text-sm font-medium\" x-text=\"result.message\"></div></div><!-- Header fields --><div class=\"grid grid-cols-1 sm:grid-cols-2 gap-4\"><div class=\"sm:col-span-2\"><label class=\"block text-xs font-medium text-slate-600 mb-1\">Narration / Description <span class=\"text-red-500\">*</span></label> <input type=\"text\" x-model=\"form.narration\" placeholder=\"e.g. Salary payment for February 2026\" class=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400\"></div><div><label class=\"block text-xs font-medium text-slate-600 mb-1\">Posting Date <span class=\"text-red-500\">*</span></label> <input type=\"date\" x-model=\"form.posting_date\" class=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400\"></div><div><label class=\"block text-xs font-medium text-slate-600 mb-1\">Document Date</label> <input type=\"date\" x-model=\"form.document_date\" class=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400\"></div><div><label class=\"block text-xs font-medium text-slate-600 mb-1\">Currency</label> <input type=\"text\" x-model=\"form.currency\" placeholder=\"INR\" maxlength=\"3\" class=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400 uppercase\"></div><div><label class=\"block text-xs font-medium text-slate-600 mb-1\">Exchange Rate</label> <input type=\"text\" x-model=\"form.exchange_rate\" placeholder=\"1.0\" class=\"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400\"></div></div><!-- Journal lines --><div><div class=\"flex items-center justify-between mb-2\"><label class=\"text-xs font-medium text-slate-600\">Journal Lines <span class=\"text-red-500\">*</span></label> <button type=\"button\" x-on:click=\"addLine()\" class=\"text-xs text-slate-600 hover:text-slate-900 flex items-center gap-1 transition-colors\">+ Add Line</button></div><div class=\"border border-gray-200 rounded-lg overflow-hidden\"><table class=\"w-full text-sm\"><thead><tr class=\"bg-slate-50 border-b border-gray-200\"><th class=\"text-left px-3 py-2 font-medium text-slate-600 text-xs w-32\">Account Code</th><th class=\"text-right px-3 py-2 font-medium text-slate-600 text-xs w-28\">Debit</th><th class=\"text-right px-3 py-2 font-medium text-slate-600 text-xs w-28\">Credit</th><th class=\"w-8\"></th></tr></thead> <tbody><template x-for=\"(line, idx) in form.lines\" x-bind:key=\"idx\"><tr class=\"border-b border-gray-100 last:border-0\"><td class=\"px-2 py-1.5\"><input type=\"text\" x-model=\"line.account_code\" placeholder=\"1100\" class=\"w-full border-0 rounded px-1 py-1 text-sm font-mono focus:outline-none focus:bg-slate-50 bg-transparent\"></td><td class=\"px-2 py-1.5\"><input type=\"text\" x-model=\"line.debit\" placeholder=\"0.00\" class=\"w-full border-0 rounded px-1 py-1 text-sm font-mono text-right focus:outline-none focus:bg-slate-50 bg-transparent\"></td><td class=\"px-2 py-1.5\"><input type=\"text\" x-model=\"line.credit\" placeholder=\"0.00\" class=\"w-full border-0 rounded px-1 py-1 text-sm font-mono text-right focus:outline-none focus:bg-slate-50 bg-transparent\"></td><td class=\"px-2 py-1.5 text-center\"><button type=\"button\" x-on:click=\"removeLine(idx)\" x-show=\"form.lines.length > 2\" class=\"text-slate-300 hover:text-red-400 transition-colors text-xs\">✕</button></td></tr></template></tbody><tfoot><tr class=\"bg-slate-50 border-t border-gray-200 text-xs\"><td class=\"px-3 py-2 font-medium text-slate-600\">Totals</td><td class=\"px-3 py-2 text-right font-mono font-semibold text-slate-800\" x-text=\"debitTotal()\"></td><td class=\"px-3 py-2 text-right font-mono font-semibold text-slate-800\" x-text=\"creditTotal()\"></td><td></td></tr></tfoot></table></div><!-- Balance check --><div class=\"mt-2 text-xs\" x-show=\"form.lines.length >= 2\"><span x-bind:class=\"isBalanced() ? 'text-green-600' : 'text-red-500'\" x-text=\"isBalanced() ? '✓ Balanced' : '⚠ Debit and Credit totals must match'\"></span></div></div><!-- Action buttons --><div class=\"flex gap-3 pt-2\"><button type=\"button\" x-on:click=\"validate()\" x-bind:disabled=\"loading\" class=\"px-4 py-2 text-sm border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50\">Validate</button> <button type=\"button\" x-on:click=\"commit()\" x-bind:disabled=\"loading || !isBalanced()\" class=\"px-4 py-2 text-sm bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition-colors disabled:opacity-50\"><span x-show=\"!loading\">Post Journal Entry</span> <span x-show=\"loading\">Posting…</span></button></div></div></div><script>\r\n\t\t\tfunction journalEntryForm(companyCode) {\r\n\t\t\t\tconst today = new Date().toISOString().split('T')[0];\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcompanyCode,\r\n\t\t\t\t\tloading: false,\r\n\t\t\t\t\tresult: { message: '', ok: false },\r\n\t\t\t\t\tform: {\r\n\t\t\t\t\t\tnarration: '',\r\n\t\t\t\t\t\tposting_date: today,\r\n\t\t\t\t\t\tdocument_date: today,\r\n\t\t\t\t\t\tcurrency: 'INR',\r\n\t\t\t\t\t\texchange_rate: '1.0',\r\n\t\t\t\t\t\tlines: [\r\n\t\t\t\t\t\t\t{ account_code: '', debit: '', credit: '' },\r\n\t\t\t\t\t\t\t{ account_code: '', debit: '', credit: '' },\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t},\r\n\t\t\t\t\taddLine() {\r\n\t\t\t\t\t\tthis.form.lines.push({ account_code: '', debit: '', credit: '' });\r\n\t\t\t\t\t},\r\n\t\t\t\t\tremoveLine(idx) {\r\n\t\t\t\t\t\tthis.form.lines.splice(idx, 1);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tparseAmount(s) {\r\n\t\t\t\t\t\tconst n = parseFloat(s || '0');\r\n\t\t\t\t\t\treturn isNaN(n) ? 0 : n;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdebitTotal() {\r\n\t\t\t\t\t\tconst t = this.form.lines.reduce((s, l) => s + this.parseAmount(l.debit), 0);\r\n\t\t\t\t\t\treturn t.toFixed(2);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcreditTotal() {\r\n\t\t\t\t\t\tconst t = this.form.lines.reduce((s, l) => s + this.parseAmount(l.credit), 0);\r\n\t\t\t\t\t\treturn t.toFixed(2);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tisBalanced() {\r\n\t\t\t\t\t\tconst d = this.form.lines.reduce((s, l) => s + this.parseAmount(l.debit), 0);\r\n\t\t\t\t\t\tconst c = this.form.lines.reduce((s, l) => s + this.parseAmount(l.credit), 0);\r\n\t\t\t\t\t\treturn Math.abs(d - c) < 0.001 && d > 0;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbuildPayload() {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tnarration: this.form.narration,\r\n\t\t\t\t\t\t\tposting_date: this.form.posting_date,\r\n\t\t\t\t\t\t\tdocument_date: this.form.document_date || this.form.posting_date,\r\n\t\t\t\t\t\t\tcurrency: this.form.currency || 'INR',\r\n\t\t\t\t\t\t\texchange_rate: this.form.exchange_rate || '1.0',\r\n\t\t\t\t\t\t\tlines: this.form.lines\r\n\t\t\t\t\t\t\t\t.filter(l => l.account_code.trim() !== '')\r\n\t\t\t\t\t\t\t\t.map(l => ({\r\n\t\t\t\t\t\t\t\t\taccount_code: l.account_code.trim(),\r\n\t\t\t\t\t\t\t\t\tdebit: l.debit || '0',\r\n\t\t\t\t\t\t\t\t\tcredit: l.credit || '0',\r\n\t\t\t\t\t\t\t\t})),\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t},\r\n\t\t\t\t\tasync validate() {\r\n\t\t\t\t\t\tthis.result = { message: '', ok: false };\r\n\t\t\t\t\t\tthis.loading = true;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst r = await fetch(`/api/companies/${this.companyCode}/journal-entries/validate`, {\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\t\t\t\t\t\tbody: JSON.stringify(this.buildPayload()),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconst data = await r.json();\r\n\t\t\t\t\t\t\tif (r.ok) {\r\n\t\t\t\t\t\t\t\tthis.result = { message: '✓ Valid — entry is ready to post.', ok: true };\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.result = { message: '⚠ ' + (data.error || 'Validation failed'), ok: false };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tthis.result = { message: 'Network error: ' + e.message, ok: false };\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tasync commit() {\r\n\t\t\t\t\t\tthis.result = { message: '', ok: false };\r\n\t\t\t\t\t\tthis.loading = true;\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst r = await fetch(`/api/companies/${this.companyCode}/journal-entries`, {\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\t\t\t\t\t\tbody: JSON.stringify(this.buildPayload()),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconst data = await r.json();\r\n\t\t\t\t\t\t\tif (r.ok) {\r\n\t\t\t\t\t\t\t\tthis.result = { message: '✓ Journal entry posted successfully.', ok: true };\r\n\t\t\t\t\t\t\t\t// Reset form lines\r\n\t\t\t\t\t\t\t\tthis.form.narration = '';\r\n\t\t\t\t\t\t\t\tthis.form.lines = [\r\n\t\t\t\t\t\t\t\t\t{ account_code: '', debit: '', credit: '' },\r\n\t\t\t\t\t\t\t\t\t{ account_code: '', debit: '', credit: '' },\r\n\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.result = { message: '⚠ ' + (data.error || 'Failed to post entry'), ok: false };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tthis.result = { message: 'Network error: ' + e.message, ok: false };\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t</script>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = layouts.AppLayout(d).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func jeCompanyCode(code string) string {
	return `"` + code + `"`
}

var _ = templruntime.GeneratedTemplate
